import pandas as pd
import numpy as np
import argparse
import os

data_path = './data'

parser = argparse.ArgumentParser()
# parser.add_argument("--path", help="csv文件路径")
# parser.add_argument("--iv", help="iv阈值", type=float, default=0.05)
# parser.add_argument("--savepath", help="结果保存路径")
args = parser.parse_args()


print('读取数据')
data = pd.read_csv(os.path.join(data_path, 'gm_model.csv'))
print('数据读取完毕')

# data.columns = ['id_card_no','card_name','loan_date','debit_ordercnt_succ_day7','debit_ordercnt_fail_day7','debit_ordercnt_succ_day15','debit_ordercnt_fail_day15','debit_ordercnt_succ_day30','debit_ordercnt_fail_day30','debit_ordercnt_succ_day90','debit_ordercnt_fail_day90','debit_ordercnt_succ_day180','debit_ordercnt_fail_day180','debit_ordercnt_succ_day360','debit_ordercnt_fail_day360','debit_membercnt_succ_day7','debit_membercnt_fail_day7','debit_membercnt_succ_day15','debit_membercnt_fail_day15','debit_membercnt_succ_day30','debit_membercnt_fail_day30','debit_membercnt_succ_day90','debit_membercnt_fail_day90','debit_membercnt_succ_day180','debit_membercnt_fail_day180','debit_membercnt_succ_day360','debit_membercnt_fail_day360','debit_cardcnt_succ_day7','debit_cardcnt_fail_day7','debit_cardcnt_succ_day15','debit_cardcnt_fail_day15','debit_cardcnt_succ_day30','debit_cardcnt_fail_day30','debit_cardcnt_succ_day90','debit_cardcnt_fail_day90','debit_cardcnt_succ_day180','debit_cardcnt_fail_day180','debit_cardcnt_succ_day360','debit_cardcnt_fail_day360','debit_membercnt_succ_times3','debit_membercnt_fail_times3','debit_membercnt_succ_times5','debit_membercnt_fail_times5','debit_membercnt_succ_times10','debit_membercnt_fail_times10','debit_membercnt_succ_times20','debit_membercnt_fail_times20','debit_cardcnt_succ_times3','debit_cardcnt_fail_times3','debit_cardcnt_succ_times5','debit_cardcnt_fail_times5','debit_cardcnt_succ_times10','debit_cardcnt_fail_times10','debit_cardcnt_succ_times20','debit_cardcnt_fail_times20','debit_ordercnt_all_day7','debit_ordercnt_all_day15','debit_ordercnt_all_day30','debit_ordercnt_all_day90','debit_ordercnt_all_day180','debit_ordercnt_all_day360','debit_membercnt_all_day7','debit_membercnt_all_day15','debit_membercnt_all_day30','debit_membercnt_all_day90','debit_membercnt_all_day180','debit_membercnt_all_day360','debit_cardcnt_all_day7','debit_cardcnt_all_day15','debit_cardcnt_all_day30','debit_cardcnt_all_day90','debit_cardcnt_all_day180','debit_cardcnt_all_day360','debit_membercnt_all_times3','debit_membercnt_all_times5','debit_membercnt_all_times10','debit_membercnt_all_times20','debit_cardcnt_all_times3','debit_cardcnt_all_times5','debit_cardcnt_all_times10','debit_cardcnt_all_times20','credit_ordercnt_succ_day7','credit_ordercnt_fail_day7','credit_ordercnt_succ_day15','credit_ordercnt_fail_day15','credit_ordercnt_succ_day30','credit_ordercnt_fail_day30','credit_ordercnt_succ_day90','credit_ordercnt_fail_day90','credit_ordercnt_succ_day180','credit_ordercnt_fail_day180','credit_ordercnt_succ_day360','credit_ordercnt_fail_day360','credit_membercnt_succ_day7','credit_membercnt_fail_day7','credit_membercnt_succ_day15','credit_membercnt_fail_day15','credit_membercnt_succ_day30','credit_membercnt_fail_day30','credit_membercnt_succ_day90','credit_membercnt_fail_day90','credit_membercnt_succ_day180','credit_membercnt_fail_day180','credit_membercnt_succ_day360','credit_membercnt_fail_day360','credit_cardcnt_succ_day7','credit_cardcnt_fail_day7','credit_cardcnt_succ_day15','credit_cardcnt_fail_day15','credit_cardcnt_succ_day30','credit_cardcnt_fail_day30','credit_cardcnt_succ_day90','credit_cardcnt_fail_day90','credit_cardcnt_succ_day180','credit_cardcnt_fail_day180','credit_cardcnt_succ_day360','credit_cardcnt_fail_day360','credit_membercnt_succ_times3','credit_membercnt_fail_times3','credit_membercnt_succ_times5','credit_membercnt_fail_times5','credit_membercnt_succ_times10','credit_membercnt_fail_times10','credit_membercnt_succ_times20','credit_membercnt_fail_times20','credit_cardcnt_succ_times3','credit_cardcnt_fail_times3','credit_cardcnt_succ_times5','credit_cardcnt_fail_times5','credit_cardcnt_succ_times10','credit_cardcnt_fail_times10','credit_cardcnt_succ_times20','credit_cardcnt_fail_times20','credit_ordercnt_all_day7','credit_ordercnt_all_day15','credit_ordercnt_all_day30','credit_ordercnt_all_day90','credit_ordercnt_all_day180','credit_ordercnt_all_day360','credit_membercnt_all_day7','credit_membercnt_all_day15','credit_membercnt_all_day30','credit_membercnt_all_day90','credit_membercnt_all_day180','credit_membercnt_all_day360','credit_cardcnt_all_day7','credit_cardcnt_all_day15','credit_cardcnt_all_day30','credit_cardcnt_all_day90','credit_cardcnt_all_day180','credit_cardcnt_all_day360','credit_membercnt_all_times3','credit_membercnt_all_times5','credit_membercnt_all_times10','credit_membercnt_all_times20','credit_cardcnt_all_times3','credit_cardcnt_all_times5','credit_cardcnt_all_times10','credit_cardcnt_all_times20','card_ordercnt_succ_day7','card_ordercnt_fail_day7','card_ordercnt_succ_day15','card_ordercnt_fail_day15','card_ordercnt_succ_day30','card_ordercnt_fail_day30','card_ordercnt_succ_day90','card_ordercnt_fail_day90','card_ordercnt_succ_day180','card_ordercnt_fail_day180','card_ordercnt_succ_day360','card_ordercnt_fail_day360','card_membercnt_succ_day7','card_membercnt_fail_day7','card_membercnt_succ_day15','card_membercnt_fail_day15','card_membercnt_succ_day30','card_membercnt_fail_day30','card_membercnt_succ_day90','card_membercnt_fail_day90','card_membercnt_succ_day180','card_membercnt_fail_day180','card_membercnt_succ_day360','card_membercnt_fail_day360','card_cardcnt_succ_day7','card_cardcnt_fail_day7','card_cardcnt_succ_day15','card_cardcnt_fail_day15','card_cardcnt_succ_day30','card_cardcnt_fail_day30','card_cardcnt_succ_day90','card_cardcnt_fail_day90','card_cardcnt_succ_day180','card_cardcnt_fail_day180','card_cardcnt_succ_day360','card_cardcnt_fail_day360','card_membercnt_succ_times3','card_membercnt_fail_times3','card_membercnt_succ_times5','card_membercnt_fail_times5','card_membercnt_succ_times10','card_membercnt_fail_times10','card_membercnt_succ_times20','card_membercnt_fail_times20','card_cardcnt_succ_times3','card_cardcnt_fail_times3','card_cardcnt_succ_times5','card_cardcnt_fail_times5','card_cardcnt_succ_times10','card_cardcnt_fail_times10','card_cardcnt_succ_times20','card_cardcnt_fail_times20','card_ordercnt_all_day7','card_ordercnt_all_day15','card_ordercnt_all_day30','card_ordercnt_all_day90','card_ordercnt_all_day180','card_ordercnt_all_day360','card_membercnt_all_day7','card_membercnt_all_day15','card_membercnt_all_day30','card_membercnt_all_day90','card_membercnt_all_day180','card_membercnt_all_day360','card_cardcnt_all_day7','card_cardcnt_all_day15','card_cardcnt_all_day30','card_cardcnt_all_day90','card_cardcnt_all_day180','card_cardcnt_all_day360','card_membercnt_all_times3','card_membercnt_all_times5','card_membercnt_all_times10','card_membercnt_all_times20','card_cardcnt_all_times3','card_cardcnt_all_times5','card_cardcnt_all_times10','card_cardcnt_all_times20','debit_distsucc_max_times3','debit_distsucc_max_times5','debit_distsucc_max_times10','debit_distsucc_max_times20','debit_distsucc_min_times3','debit_distsucc_min_times5','debit_distsucc_min_times10','debit_distsucc_min_times20','debit_distsucc_avg_times3','debit_distsucc_avg_times5','debit_distsucc_avg_times10','debit_distsucc_avg_times20','debit_distfail_max_times3','debit_distfail_max_times5','debit_distfail_max_times10','debit_distfail_max_times20','debit_distfail_min_times3','debit_distfail_min_times5','debit_distfail_min_times10','debit_distfail_min_times20','debit_distfail_avg_times3','debit_distfail_avg_times5','debit_distfail_avg_times10','debit_distfail_avg_times20','debit_distall_max_times3','debit_distall_max_times5','debit_distall_max_times10','debit_distall_max_times20','debit_distall_min_times3','debit_distall_min_times5','debit_distall_min_times10','debit_distall_min_times20','debit_distall_avg_times3','debit_distall_avg_times5','debit_distall_avg_times10','debit_distall_avg_times20','credit_distsucc_max_times3','credit_distsucc_max_times5','credit_distsucc_max_times10','credit_distsucc_max_times20','credit_distsucc_min_times3','credit_distsucc_min_times5','credit_distsucc_min_times10','credit_distsucc_min_times20','credit_distsucc_avg_times3','credit_distsucc_avg_times5','credit_distsucc_avg_times10','credit_distsucc_avg_times20','credit_distfail_max_times3','credit_distfail_max_times5','credit_distfail_max_times10','credit_distfail_max_times20','credit_distfail_min_times3','credit_distfail_min_times5','credit_distfail_min_times10','credit_distfail_min_times20','credit_distfail_avg_times3','credit_distfail_avg_times5','credit_distfail_avg_times10','credit_distfail_avg_times20','credit_distall_max_times3','credit_distall_max_times5','credit_distall_max_times10','credit_distall_max_times20','credit_distall_min_times3','credit_distall_min_times5','credit_distall_min_times10','credit_distall_min_times20','credit_distall_avg_times3','credit_distall_avg_times5','credit_distall_avg_times10','credit_distall_avg_times20','card_distsucc_max_times3','card_distsucc_max_times5','card_distsucc_max_times10','card_distsucc_max_times20','card_distsucc_min_times3','card_distsucc_min_times5','card_distsucc_min_times10','card_distsucc_min_times20','card_distsucc_avg_times3','card_distsucc_avg_times5','card_distsucc_avg_times10','card_distsucc_avg_times20','card_distfail_max_times3','card_distfail_max_times5','card_distfail_max_times10','card_distfail_max_times20','card_distfail_min_times3','card_distfail_min_times5','card_distfail_min_times10','card_distfail_min_times20','card_distfail_avg_times3','card_distfail_avg_times5','card_distfail_avg_times10','card_distfail_avg_times20','card_distall_max_times3','card_distall_max_times5','card_distall_max_times10','card_distall_max_times20','card_distall_min_times3','card_distall_min_times5','card_distall_min_times10','card_distall_min_times20','card_distall_avg_times3','card_distall_avg_times5','card_distall_avg_times10','card_distall_avg_times20','card_ordercnt_all_all','card_ordercnt_samec_all','card_ordercnt_samem_all','card_ordercnt_samed_all','card_membercnt_samec_samed','card_ordercnt_samec_samem','card_ordercnt_samem_samed','debit_ordercnt_succ_all','debit_ordercnt_fail_all','debit_membercnt_succ_all','debit_membercnt_fail_all','debit_cardcnt_succ_all','debit_cardcnt_fail_all','debit_ordercnt_all_all','debit_membercnt_all_all','debit_cardcnt_all_all','credit_ordercnt_succ_all','credit_ordercnt_fail_all','credit_membercnt_succ_all','credit_membercnt_fail_all','credit_cardcnt_succ_all','credit_cardcnt_fail_all','credit_ordercnt_all_all','credit_membercnt_all_all','credit_cardcnt_all_all','card_ordercnt_succ_all','card_ordercnt_fail_all','card_membercnt_succ_all','card_membercnt_fail_all','card_cardcnt_succ_all','card_cardcnt_fail_all','card_membercnt_all_all','card_cardcnt_all_all','daikou_distsucc_max_times3','daikou_distsucc_min_times3','daikou_distsucc_max_times5','daikou_distsucc_min_times5','daikou_distsucc_max_times10','daikou_distsucc_min_times10','daikou_distsucc_max_times20','daikou_distsucc_min_times20','daikou_distfail_max_times3','daikou_distfail_min_times3','daikou_distfail_max_times5','daikou_distfail_min_times5','daikou_distfail_max_times10','daikou_distfail_min_times10','daikou_distfail_max_times20','daikou_distfail_min_times20','daikou_distlowc_max_times3','daikou_distlowc_min_times3','daikou_distlowc_max_times5','daikou_distlowc_min_times5','daikou_distlowc_max_times10','daikou_distlowc_min_times10','daikou_distlowc_max_times20','daikou_distlowc_min_times20','daikou_distall_max_times3','daikou_distall_min_times3','daikou_distall_max_times5','daikou_distall_min_times5','daikou_distall_max_times10','daikou_distall_min_times10','daikou_distall_max_times20','daikou_distall_min_times20','daikou_distsucc_avg_times3','daikou_distsucc_avg_times5','daikou_distsucc_avg_times10','daikou_distsucc_avg_times20','daikou_distfail_avg_times3','daikou_distfail_avg_times5','daikou_distfail_avg_times10','daikou_distfail_avg_times20','daikou_distlowc_avg_times3','daikou_distlowc_avg_times5','daikou_distlowc_avg_times10','daikou_distlowc_avg_times20','daikou_distall_avg_times3','daikou_distall_avg_times5','daikou_distall_avg_times10','daikou_distall_avg_times20','daikou_ordercnt_succ_day7','daikou_ordercnt_fail_day7','daikou_ordercnt_lowc_day7','daikou_ordercnt_succ_day15','daikou_ordercnt_fail_day15','daikou_ordercnt_lowc_day15','daikou_ordercnt_succ_day30','daikou_ordercnt_fail_day30','daikou_ordercnt_lowc_day30','daikou_ordercnt_succ_day90','daikou_ordercnt_fail_day90','daikou_ordercnt_lowc_day90','daikou_ordercnt_succ_day180','daikou_ordercnt_fail_day180','daikou_ordercnt_lowc_day180','daikou_ordercnt_succ_day360','daikou_ordercnt_fail_day360','daikou_ordercnt_lowc_day360','daikou_membercnt_succ_day7','daikou_membercnt_fail_day7','daikou_membercnt_lowc_day7','daikou_membercnt_succ_day15','daikou_membercnt_fail_day15','daikou_membercnt_lowc_day15','daikou_membercnt_succ_day30','daikou_membercnt_fail_day30','daikou_membercnt_lowc_day30','daikou_membercnt_succ_day90','daikou_membercnt_fail_day90','daikou_membercnt_lowc_day90','daikou_membercnt_succ_day180','daikou_membercnt_fail_day180','daikou_membercnt_lowc_day180','daikou_membercnt_succ_day360','daikou_membercnt_fail_day360','daikou_membercnt_lowc_day360','daikou_membercnt_succ_all','daikou_membercnt_fail_all','daikou_membercnt_lowc_all','daikou_ordercnt_succ_all','daikou_ordercnt_fail_all','daikou_ordercnt_lowc_all','daikou_minamt_succ_day7','daikou_minamt_succ_day15','daikou_minamt_succ_day30','daikou_minamt_succ_day90','daikou_minamt_succ_day180','daikou_minamt_succ_day360','daikou_minamt_succ_times3','daikou_minamt_succ_times5','daikou_minamt_succ_times10','daikou_minamt_succ_times20','daikou_minamt_succ_all','daikou_minamt_fail_day7','daikou_minamt_fail_day15','daikou_minamt_fail_day30','daikou_minamt_fail_day90','daikou_minamt_fail_day180','daikou_minamt_fail_day360','daikou_minamt_fail_times3','daikou_minamt_fail_times5','daikou_minamt_fail_times10','daikou_minamt_fail_times20','daikou_minamt_fail_all','daikou_minamt_lowc_day7','daikou_minamt_lowc_day15','daikou_minamt_lowc_day30','daikou_minamt_lowc_day90','daikou_minamt_lowc_day180','daikou_minamt_lowc_day360','daikou_minamt_lowc_times3','daikou_minamt_lowc_times5','daikou_minamt_lowc_times10','daikou_minamt_lowc_times20','daikou_minamt_lowc_all','daikou_minamt_all_day7','daikou_minamt_all_day15','daikou_minamt_all_day30','daikou_minamt_all_day90','daikou_minamt_all_day180','daikou_minamt_all_day360','daikou_minamt_all_times3','daikou_minamt_all_times5','daikou_minamt_all_times10','daikou_minamt_all_times20','daikou_minamt_all_all','daikou_maxamt_succ_day7','daikou_maxamt_succ_day15','daikou_maxamt_succ_day30','daikou_maxamt_succ_day90','daikou_maxamt_succ_day180','daikou_maxamt_succ_day360','daikou_maxamt_succ_times3','daikou_maxamt_succ_times5','daikou_maxamt_succ_times10','daikou_maxamt_succ_times20','daikou_maxamt_succ_all','daikou_maxamt_fail_day7','daikou_maxamt_fail_day15','daikou_maxamt_fail_day30','daikou_maxamt_fail_day90','daikou_maxamt_fail_day180','daikou_maxamt_fail_day360','daikou_maxamt_fail_times3','daikou_maxamt_fail_times5','daikou_maxamt_fail_times10','daikou_maxamt_fail_times20','daikou_maxamt_fail_all','daikou_maxamt_lowc_day7','daikou_maxamt_lowc_day15','daikou_maxamt_lowc_day30','daikou_maxamt_lowc_day90','daikou_maxamt_lowc_day180','daikou_maxamt_lowc_day360','daikou_maxamt_lowc_times3','daikou_maxamt_lowc_times5','daikou_maxamt_lowc_times10','daikou_maxamt_lowc_times20','daikou_maxamt_lowc_all','daikou_maxamt_all_day7','daikou_maxamt_all_day15','daikou_maxamt_all_day30','daikou_maxamt_all_day90','daikou_maxamt_all_day180','daikou_maxamt_all_day360','daikou_maxamt_all_times3','daikou_maxamt_all_times5','daikou_maxamt_all_times10','daikou_maxamt_all_times20','daikou_maxamt_all_all','daikou_avgamt_succ_day7','daikou_avgamt_succ_day15','daikou_avgamt_succ_day30','daikou_avgamt_succ_day90','daikou_avgamt_succ_day180','daikou_avgamt_succ_day360','daikou_avgamt_succ_times3','daikou_avgamt_succ_times5','daikou_avgamt_succ_times10','daikou_avgamt_succ_times20','daikou_avgamt_succ_all','daikou_avgamt_fail_day7','daikou_avgamt_fail_day15','daikou_avgamt_fail_day30','daikou_avgamt_fail_day90','daikou_avgamt_fail_day180','daikou_avgamt_fail_day360','daikou_avgamt_fail_times3','daikou_avgamt_fail_times5','daikou_avgamt_fail_times10','daikou_avgamt_fail_times20','daikou_avgamt_fail_all','daikou_avgamt_lowc_day7','daikou_avgamt_lowc_day15','daikou_avgamt_lowc_day30','daikou_avgamt_lowc_day90','daikou_avgamt_lowc_day180','daikou_avgamt_lowc_day360','daikou_avgamt_lowc_times3','daikou_avgamt_lowc_times5','daikou_avgamt_lowc_times10','daikou_avgamt_lowc_times20','daikou_avgamt_lowc_all','daikou_avgamt_all_day7','daikou_avgamt_all_day15','daikou_avgamt_all_day30','daikou_avgamt_all_day90','daikou_avgamt_all_day180','daikou_avgamt_all_day360','daikou_avgamt_all_times3','daikou_avgamt_all_times5','daikou_avgamt_all_times10','daikou_avgamt_all_times20','daikou_avgamt_all_all','daikou_stdamt_succ_day7','daikou_stdamt_succ_day15','daikou_stdamt_succ_day30','daikou_stdamt_succ_day90','daikou_stdamt_succ_day180','daikou_stdamt_succ_day360','daikou_stdamt_succ_times3','daikou_stdamt_succ_times5','daikou_stdamt_succ_times10','daikou_stdamt_succ_times20','daikou_stdamt_succ_all','daikou_stdamt_fail_day7','daikou_stdamt_fail_day15','daikou_stdamt_fail_day30','daikou_stdamt_fail_day90','daikou_stdamt_fail_day180','daikou_stdamt_fail_day360','daikou_stdamt_fail_times3','daikou_stdamt_fail_times5','daikou_stdamt_fail_times10','daikou_stdamt_fail_times20','daikou_stdamt_fail_all','daikou_stdamt_lowc_day7','daikou_stdamt_lowc_day15','daikou_stdamt_lowc_day30','daikou_stdamt_lowc_day90','daikou_stdamt_lowc_day180','daikou_stdamt_lowc_day360','daikou_stdamt_lowc_times3','daikou_stdamt_lowc_times5','daikou_stdamt_lowc_times10','daikou_stdamt_lowc_times20','daikou_stdamt_lowc_all','daikou_stdamt_all_day7','daikou_stdamt_all_day15','daikou_stdamt_all_day30','daikou_stdamt_all_day90','daikou_stdamt_all_day180','daikou_stdamt_all_day360','daikou_stdamt_all_times3','daikou_stdamt_all_times5','daikou_stdamt_all_times10','daikou_stdamt_all_times20','daikou_stdamt_all_all','daifu_distsucc_max_times3','daifu_distsucc_min_times3','daifu_distsucc_max_times5','daifu_distsucc_min_times5','daifu_distsucc_max_times10','daifu_distsucc_min_times10','daifu_distsucc_max_times20','daifu_distsucc_min_times20','daifu_distfail_max_times3','daifu_distfail_min_times3','daifu_distfail_max_times5','daifu_distfail_min_times5','daifu_distfail_max_times10','daifu_distfail_min_times10','daifu_distfail_max_times20','daifu_distfail_min_times20','daifu_distall_max_times3','daifu_distall_min_times3','daifu_distall_max_times5','daifu_distall_min_times5','daifu_distall_max_times10','daifu_distall_min_times10','daifu_distall_max_times20','daifu_distall_min_times20','daifu_distsucc_avg_times3','daifu_distsucc_avg_times5','daifu_distsucc_avg_times10','daifu_distsucc_avg_times20','daifu_distfail_avg_times3','daifu_distfail_avg_times5','daifu_distfail_avg_times10','daifu_distfail_avg_times20','daifu_distall_avg_times3','daifu_distall_avg_times5','daifu_distall_avg_times10','daifu_distall_avg_times20','daifu_ordercnt_succ_day7','daifu_ordercnt_fail_day7','daifu_ordercnt_succ_day15','daifu_ordercnt_fail_day15','daifu_ordercnt_succ_day30','daifu_ordercnt_fail_day30','daifu_ordercnt_succ_day90','daifu_ordercnt_fail_day90','daifu_ordercnt_succ_day180','daifu_ordercnt_fail_day180','daifu_ordercnt_succ_day360','daifu_ordercnt_fail_day360','daifu_membercnt_succ_day7','daifu_membercnt_fail_day7','daifu_membercnt_succ_day15','daifu_membercnt_fail_day15','daifu_membercnt_succ_day30','daifu_membercnt_fail_day30','daifu_membercnt_succ_day90','daifu_membercnt_fail_day90','daifu_membercnt_succ_day180','daifu_membercnt_fail_day180','daifu_membercnt_succ_day360','daifu_membercnt_fail_day360','daifu_ordercnt_unkw_day7','daifu_ordercnt_unkw_day15','daifu_ordercnt_unkw_day30','daifu_ordercnt_unkw_day90','daifu_ordercnt_unkw_day180','daifu_ordercnt_unkw_day360','daifu_membercnt_unkw_day7','daifu_membercnt_unkw_day15','daifu_membercnt_unkw_day30','daifu_membercnt_unkw_day90','daifu_membercnt_unkw_day180','daifu_membercnt_unkw_day360','daifu_ordercnt_succ_all','daifu_ordercnt_fail_all','daifu_membercnt_succ_all','daifu_membercnt_fail_all','daifu_ordercnt_unkw_all','daifu_membercnt_unkw_all','daifu_minamt_succ_day7','daifu_minamt_succ_day15','daifu_minamt_succ_day30','daifu_minamt_succ_day90','daifu_minamt_succ_day180','daifu_minamt_succ_day360','daifu_minamt_succ_times3','daifu_minamt_succ_times5','daifu_minamt_succ_times10','daifu_minamt_succ_times20','daifu_minamt_succ_all','daifu_minamt_fail_day7','daifu_minamt_fail_day15','daifu_minamt_fail_day30','daifu_minamt_fail_day90','daifu_minamt_fail_day180','daifu_minamt_fail_day360','daifu_minamt_fail_times3','daifu_minamt_fail_times5','daifu_minamt_fail_times10','daifu_minamt_fail_times20','daifu_minamt_fail_all','daifu_minamt_unkw_day7','daifu_minamt_unkw_day15','daifu_minamt_unkw_day30','daifu_minamt_unkw_day90','daifu_minamt_unkw_day180','daifu_minamt_unkw_day360','daifu_minamt_unkw_times3','daifu_minamt_unkw_times5','daifu_minamt_unkw_times10','daifu_minamt_unkw_times20','daifu_minamt_unkw_all','daifu_minamt_all_day7','daifu_minamt_all_day15','daifu_minamt_all_day30','daifu_minamt_all_day90','daifu_minamt_all_day180','daifu_minamt_all_day360','daifu_minamt_all_times3','daifu_minamt_all_times5','daifu_minamt_all_times10','daifu_minamt_all_times20','daifu_minamt_all_all','daifu_maxamt_succ_day7','daifu_maxamt_succ_day15','daifu_maxamt_succ_day30','daifu_maxamt_succ_day90','daifu_maxamt_succ_day180','daifu_maxamt_succ_day360','daifu_maxamt_succ_times3','daifu_maxamt_succ_times5','daifu_maxamt_succ_times10','daifu_maxamt_succ_times20','daifu_maxamt_succ_all','daifu_maxamt_fail_day7','daifu_maxamt_fail_day15','daifu_maxamt_fail_day30','daifu_maxamt_fail_day90','daifu_maxamt_fail_day180','daifu_maxamt_fail_day360','daifu_maxamt_fail_times3','daifu_maxamt_fail_times5','daifu_maxamt_fail_times10','daifu_maxamt_fail_times20','daifu_maxamt_fail_all','daifu_maxamt_unkw_day7','daifu_maxamt_unkw_day15','daifu_maxamt_unkw_day30','daifu_maxamt_unkw_day90','daifu_maxamt_unkw_day180','daifu_maxamt_unkw_day360','daifu_maxamt_unkw_times3','daifu_maxamt_unkw_times5','daifu_maxamt_unkw_times10','daifu_maxamt_unkw_times20','daifu_maxamt_unkw_all','daifu_maxamt_all_day7','daifu_maxamt_all_day15','daifu_maxamt_all_day30','daifu_maxamt_all_day90','daifu_maxamt_all_day180','daifu_maxamt_all_day360','daifu_maxamt_all_times3','daifu_maxamt_all_times5','daifu_maxamt_all_times10','daifu_maxamt_all_times20','daifu_maxamt_all_all','daifu_avgamt_succ_day7','daifu_avgamt_succ_day15','daifu_avgamt_succ_day30','daifu_avgamt_succ_day90','daifu_avgamt_succ_day180','daifu_avgamt_succ_day360','daifu_avgamt_succ_times3','daifu_avgamt_succ_times5','daifu_avgamt_succ_times10','daifu_avgamt_succ_times20','daifu_avgamt_succ_all','daifu_avgamt_fail_day7','daifu_avgamt_fail_day15','daifu_avgamt_fail_day30','daifu_avgamt_fail_day90','daifu_avgamt_fail_day180','daifu_avgamt_fail_day360','daifu_avgamt_fail_times3','daifu_avgamt_fail_times5','daifu_avgamt_fail_times10','daifu_avgamt_fail_times20','daifu_avgamt_fail_all','daifu_avgamt_unkw_day7','daifu_avgamt_unkw_day15','daifu_avgamt_unkw_day30','daifu_avgamt_unkw_day90','daifu_avgamt_unkw_day180','daifu_avgamt_unkw_day360','daifu_avgamt_unkw_times3','daifu_avgamt_unkw_times5','daifu_avgamt_unkw_times10','daifu_avgamt_unkw_times20','daifu_avgamt_unkw_all','daifu_avgamt_all_day7','daifu_avgamt_all_day15','daifu_avgamt_all_day30','daifu_avgamt_all_day90','daifu_avgamt_all_day180','daifu_avgamt_all_day360','daifu_avgamt_all_times3','daifu_avgamt_all_times5','daifu_avgamt_all_times10','daifu_avgamt_all_times20','daifu_avgamt_all_all','daifu_stdamt_succ_day7','daifu_stdamt_succ_day15','daifu_stdamt_succ_day30','daifu_stdamt_succ_day90','daifu_stdamt_succ_day180','daifu_stdamt_succ_day360','daifu_stdamt_succ_times3','daifu_stdamt_succ_times5','daifu_stdamt_succ_times10','daifu_stdamt_succ_times20','daifu_stdamt_succ_all','daifu_stdamt_fail_day7','daifu_stdamt_fail_day15','daifu_stdamt_fail_day30','daifu_stdamt_fail_day90','daifu_stdamt_fail_day180','daifu_stdamt_fail_day360','daifu_stdamt_fail_times3','daifu_stdamt_fail_times5','daifu_stdamt_fail_times10','daifu_stdamt_fail_times20','daifu_stdamt_fail_all','daifu_stdamt_unkw_day7','daifu_stdamt_unkw_day15','daifu_stdamt_unkw_day30','daifu_stdamt_unkw_day90','daifu_stdamt_unkw_day180','daifu_stdamt_unkw_day360','daifu_stdamt_unkw_times3','daifu_stdamt_unkw_times5','daifu_stdamt_unkw_times10','daifu_stdamt_unkw_times20','daifu_stdamt_unkw_all','daifu_stdamt_all_day7','daifu_stdamt_all_day15','daifu_stdamt_all_day30','daifu_stdamt_all_day90','daifu_stdamt_all_day180','daifu_stdamt_all_day360','daifu_stdamt_all_times3','daifu_stdamt_all_times5','daifu_stdamt_all_times10','daifu_stdamt_all_times20','daifu_stdamt_all_all','target']

deleted_features = []
for col in list(data.columns):
    if len(set(data[col])) == 1:
        # del zz_train_data[col]   # 原数据中删除
        deleted_features.append(col)
features_remove = ['id_card_no', 'card_name', 'loan_date', 'target'] + deleted_features
all_features = [i for i in list(data.columns) if i not in features_remove]


def CalcWOE(df, col, target):
    """
    :param df: dataframe containing feature and target
    :param col: the feature that needs to be calculated the WOE and iv, usually categorical type
    :param target: good/bad indicator
    :return: WOE and IV in a dictionary
    """
    total = df.groupby([col])[target].count()
    total = pd.DataFrame({'total': total})
    bad = df.groupby([col])[target].sum()
    bad = pd.DataFrame({'bad': bad})
    regroup = total.merge(bad, left_index=True, right_index=True, how='left')  # 按索引拼接
    regroup.reset_index(inplace=True)  # 原表中重设行索引
    # regroup.reset_index(level=0, inplace=True)
    regroup['good'] = regroup['total'] - regroup['bad']
    # print(regroup)
    # regroup = regroup.replace(0, 1)
    N = sum(regroup['total'])
    B = sum(regroup['bad'])
    G = N - B
    regroup['bad_pcnt'] = regroup['bad'].map(lambda x: x * 1.0 / B)
    regroup['good_pcnt'] = regroup['good'].map(lambda x: x * 1.0 / G)
    regroup['WOE'] = regroup.apply(lambda x: np.log(x.good_pcnt * 1.0 / (x.bad_pcnt + 0.00001)), axis=1)  # 数据框为整个或各列，序列为元素
    WOE_dict = regroup[[col, 'WOE']].set_index(col).to_dict(orient='index')
    IV = regroup.apply(lambda x: (x.good_pcnt - x.bad_pcnt) * np.log(x.good_pcnt * 1.0 / (x.bad_pcnt + 0.00001)), axis=1)
    IV = sum(IV)
    return (IV, WOE_dict)

# print('开始粗筛选，设置的iv值为{}'.format(args.iv))
var_IV = {}
var_WOE = {}
var_cutoff = {}
var_cutoff_test={}
select_features =[]

# 增加缺失值作为分区  unsupported operand type(s) for -: 'int' and 'str'
for col in all_features:
        # col =  'cdq_dd_jiedai_sum_amt_amt_d15_d15'
        col_Bin = col + '_Bin'
        # zz_train_data[col_Bin], var_cutoff[col] = pd.qcut(zz_train_data[col], 20)
        # zz_train_data[col]
        data1 = data[col][data[col] < 0]
        data2 = data[col][data[col] >= 0]
        nanlist = sorted(list(set(data1)))
        datanew = []
        data2 = data2.apply(lambda x: float(x))
        if len(set(data2)) > 1:

            data3, var_cutoff[col] = pd.qcut(data2, 5, duplicates='drop', retbins=True)
        else:

            var_cutoff[col] = set(data2)
        var_cutoff_test[col] = np.array([-np.inf] + nanlist + list(var_cutoff[col])[1:-1] + [np.inf])
        data[col_Bin] = pd.cut(data[col], var_cutoff_test[col])
        var_IV[col], var_WOE[col] = CalcWOE(data, col_Bin, 'target')
        print('step {} finish!!'.format(col))
        # 设置筛选iv的阈值
        if var_IV[col] >= 0:
                select_features.append((col, var_IV[col]))
                print(pd.crosstab(data[col_Bin], data['target']))
                print('var {} IV is {}.'.format(col, var_IV[col]))
col_sort = sorted(select_features, key=lambda x: x[1], reverse=True)
col_sort1 = []
for i, j in col_sort[:80]:
        col_sort1.append(i)
col_IVa = pd.DataFrame(pd.Series(var_IV))
col_IVa.to_excel(os.path.join(data_path, 'iv_zong.xlsx'))
data_sele=data[['id_card_no', 'card_name', 'loan_date', 'target']+col_sort1]
print('筛选结束，保留变量数为:{}'.format(len(col_sort1)))
data_sele.to_csv(os.path.join(data_path, 'data_sele.csv'), index=False)